# Добавление аутентификации в Swagger

## Введение

При работе с API, защищенными механизмами аутентификации, важно, чтобы Swagger-документация отражала эти особенности. Это позволяет разработчикам и тестировщикам удобно использовать защищенные эндпоинты.

## Проблема

Если аутентификация не отображена в Swagger, пользователи документации могут столкнуться с трудностями при попытке тестирования защищенных маршрутов. Это приведет к необходимости вручную указывать токены или другие данные, что не всегда удобно и может вызвать ошибки.

## Решение

В NestJS можно легко интегрировать аутентификацию в Swagger с помощью декораторов и настроек. Вот шаги, которые нужно выполнить:

### 1. Установка необходимых пакетов

Убедитесь, что у вас установлены все необходимые пакеты для работы со Swagger:

```bash
npm install --save @nestjs/swagger swagger-ui-express
```

### 2. Добавление декораторов в контроллер

Используйте декораторы `@ApiBearerAuth()` и `@ApiSecurity()` для указания, что эндпоинты требуют Bearer аутентификацию:

```typescript
import { Controller, Get, UseGuards } from "@nestjs/common";
import { ApiBearerAuth, ApiTags } from "@nestjs/swagger";
import { AuthGuard } from "@nestjs/passport";

@ApiTags("user")
@Controller("user")
export class UserController {
  @ApiBearerAuth() // Добавляем аутентификацию через Bearer Token
  @UseGuards(AuthGuard("jwt"))
  @Get("profile")
  getProfile() {
    // Код, возвращающий профиль пользователя
  }
}
```

### 3. Настройка Swagger в приложении

При инициализации Swagger добавьте поддержку Bearer Token:

```typescript
import { DocumentBuilder, SwaggerModule } from "@nestjs/swagger";

const config = new DocumentBuilder()
  .setTitle("API")
  .setDescription("API документация")
  .setVersion("1.0")
  .addBearerAuth() // Добавляем поддержку Bearer Token
  .build();

const document = SwaggerModule.createDocument(app, config);
SwaggerModule.setup("api", app, document);
```

### 4. Просмотр аутентифицированных эндпоинтов

Теперь при открытии Swagger-документации, вы увидите возможность указать Bearer Token для выполнения запросов. Это упростит тестирование защищенных маршрутов и сделает документацию более полной и удобной.

## Заключение

Добавление аутентификации в Swagger — это необходимый шаг для обеспечения безопасности и удобства использования вашей API. С помощью декораторов `@ApiBearerAuth()` и настроек в `DocumentBuilder` вы можете легко интегрировать аутентификацию в вашу Swagger-документацию.
